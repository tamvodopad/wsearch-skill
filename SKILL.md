---
name: wsearch
description: Search WW2 soldiers from warsearch.ru by location and export results to Excel. Use when user asks to find war participants, search soldiers by village/city, or collect WW2 data from warsearch.
allowed-tools: Bash,Read,Write,Grep,Glob,mcp__claude-in-chrome__*
---

# WSearch - Поиск участников ВОВ

Автоматизированный сбор данных об участниках Великой Отечественной войны с сайта warsearch.ru с экспортом в Excel.

## Когда использовать

- Пользователь просит найти участников ВОВ по населённому пункту
- Нужно собрать данные о солдатах для генеалогического исследования
- Требуется систематический поиск с разными вариантами написания

## Начальный сбор информации

Перед началом работы задай 5 вопросов:

### 1. Целевой населённый пункт
Точное название как в документах военного времени.

### 2. Административные привязки
Район, область или другие уточняющие маркеры.

### 3. Варианты написания
3-10 документированных вариантов (старые названия, ошибки транслитерации).

**По умолчанию:** Основное название + 2-3 очевидных варианта.

### 4. Критерии включения
- Место рождения
- Место жительства
- Место призыва
- Место захоронения
- Комбинации

**По умолчанию:** Рождение ИЛИ жительство ИЛИ призыв.

### 5. Целевая популяция
- Погибшие
- Пропавшие без вести
- Все участники
- Конкретные категории

**По умолчанию:** Все участники.

## Структура результата (results.xlsx)

### Лист 1: "Итог" (подтверждённые записи)

| Колонка | Описание |
|---------|----------|
| ФИО | Полное имя солдата |
| Год рождения | Год рождения |
| Статус | Нормализованный статус (погиб, пропал б/в, вернулся) |
| Ссылка warsearch | URL карточки на warsearch.ru |
| Ссылка Память народа | URL на pamyat-naroda.ru (если есть) |
| Основание (A/B/C) | Уровень подтверждения связи с локацией |
| Источник географии | Поле откуда взята география |

### Лист 2: "Кандидаты" (неопределённые совпадения)

| Колонка | Описание |
|---------|----------|
| ФИО | Имя солдата |
| Год рождения | Год рождения |
| Причина сомнения | Почему не в "Итог" |
| Ссылка | URL карточки |
| Географические заметки | Что известно о географии |

### Лист 3: "Журнал" (лог поиска)

| Колонка | Описание |
|---------|----------|
| Вариант запроса | Использованный поисковый запрос |
| Попытка | Номер попытки |
| Сигнал | A/B/C/D/UNDEFINED |
| Количество результатов | Найдено записей |

### Лист 4: "Варианты" (использованные варианты написания)

Список всех вариантов названия, которые были использованы в поиске.

## Протокол ожидания загрузки

### Обязательные сигналы подтверждения

Страница считается загруженной только при появлении одного из сигналов:

- **A:** Видимый список результатов
- **B:** Отображено количество результатов
- **C:** Видна пагинация
- **D:** Явное сообщение "нет результатов"

### Таймауты

| Попытка | Действие | Ожидание |
|---------|----------|----------|
| 1 | Начальная загрузка | 8-12 сек |
| 2 | Обновление страницы + ожидание | 8-12 сек |
| 3 | Повтор действия + ожидание | 8-12 сек |

Без сигнала — страница не загружена. Не переходить к следующему шагу.

## Логика верификации (A/B/C)

### Уровень A — Полное подтверждение
Точное название населённого пункта найдено в полях:
- Место рождения
- Место жительства
- Место призыва
- Место захоронения

### Уровень B — Административное подтверждение
Совпадение административных привязок + короткий вариант названия.

### Уровень C — Внешнее подтверждение
Прямая ссылка на "Память народа" подтверждает географию.

### Неподтверждённые
Записи без подтверждения A/B/C идут в "Кандидаты".

## Алгоритм работы

```
1. СБОР ПАРАМЕТРОВ
   └─ Задать 5 вопросов
   └─ Установить значения по умолчанию для пропущенных

2. ПОДГОТОВКА ВАРИАНТОВ
   └─ Основное название
   └─ Варианты написания
   └─ Комбинации с районом/областью

3. ПОИСК
   Для каждого варианта:
   ├─ Открыть warsearch.ru
   ├─ Ввести запрос
   ├─ Ждать сигнал (A/B/C/D)
   ├─ Записать в журнал
   └─ Обработать результаты

4. ОБРАБОТКА РЕЗУЛЬТАТОВ
   Для каждой записи:
   ├─ Открыть карточку
   ├─ Извлечь данные
   ├─ Проверить географию (A/B/C)
   └─ Распределить в "Итог" или "Кандидаты"

5. ЭКСПОРТ
   └─ Создать results.xlsx
   └─ Заполнить 4 листа
```

## Навигация по warsearch.ru

### Главная страница
URL: `https://warsearch.ru/`

### Поиск
1. Найти поле поиска
2. Ввести запрос (название населённого пункта)
3. Нажать кнопку поиска или Enter
4. Дождаться загрузки результатов

### Карточка солдата
Содержит поля:
- ФИО
- Дата рождения
- Место рождения
- Место призыва
- Воинская часть
- Звание
- Дата выбытия
- Причина выбытия
- Место захоронения
- Ссылки на источники

## Создание Excel файла

```python
# Используем openpyxl для создания Excel
import openpyxl
from openpyxl import Workbook

wb = Workbook()

# Лист 1: Итог
ws1 = wb.active
ws1.title = "Итог"
ws1.append(["ФИО", "Год рождения", "Статус", "Ссылка warsearch",
            "Ссылка Память народа", "Основание", "Источник географии"])

# Лист 2: Кандидаты
ws2 = wb.create_sheet("Кандидаты")
ws2.append(["ФИО", "Год рождения", "Причина сомнения", "Ссылка", "География"])

# Лист 3: Журнал
ws3 = wb.create_sheet("Журнал")
ws3.append(["Вариант запроса", "Попытка", "Сигнал", "Количество"])

# Лист 4: Варианты
ws4 = wb.create_sheet("Варианты")
ws4.append(["Вариант написания"])

wb.save("results.xlsx")
```

## Нормализация статусов

| Исходный текст | Нормализованный |
|----------------|-----------------|
| погиб, убит | Погиб |
| пропал без вести, пропал б/в | Пропал без вести |
| умер от ран | Умер от ран |
| умер в плену | Умер в плену |
| вернулся, жив | Вернулся |

## Обработка ошибок

### Страница не загружается
1. Подождать 12 секунд
2. Обновить страницу
3. Если не помогло — записать в журнал и перейти к следующему запросу

### Нет результатов
Записать в журнал сигнал D, перейти к следующему варианту.

### Капча или блокировка
Сообщить пользователю, приостановить работу.

## Пример использования

```
Пользователь: Найди всех участников ВОВ из деревни Вишур

Агент: Уточню параметры поиска:

1. Населённый пункт: Вишур
2. Район/область?
3. Варианты написания (Вишур, Vishur, и т.д.)?
4. Критерии: рождение/жительство/призыв?
5. Кого ищем: всех или только погибших?

[После ответов]

Начинаю поиск...
- Вариант "Вишур": найдено 47 записей
- Вариант "Вишур Можгинский район": найдено 32 записи
- Вариант "д. Вишур": найдено 28 записей

Обрабатываю карточки...
[Прогресс: 47/47]

Готово! Создан файл results.xlsx:
- Итог: 42 подтверждённых записи
- Кандидаты: 5 неопределённых
- Всего запросов: 3
```

## Ограничения

- Скорость ограничена для избежания блокировки
- Некоторые карточки могут быть недоступны
- Качество данных зависит от источника
- Варианты написания влияют на полноту результатов
